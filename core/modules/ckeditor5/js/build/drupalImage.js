!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.CKEditor5=e():(t.CKEditor5=t.CKEditor5||{},t.CKEditor5.drupalImage=e())}(globalThis,(()=>(()=>{var t={"ckeditor5/src/core.js":(t,e,i)=>{t.exports=i("dll-reference CKEditor5.dll")("./src/core.js")},"ckeditor5/src/engine.js":(t,e,i)=>{t.exports=i("dll-reference CKEditor5.dll")("./src/engine.js")},"ckeditor5/src/ui.js":(t,e,i)=>{t.exports=i("dll-reference CKEditor5.dll")("./src/ui.js")},"ckeditor5/src/upload.js":(t,e,i)=>{t.exports=i("dll-reference CKEditor5.dll")("./src/upload.js")},"ckeditor5/src/utils.js":(t,e,i)=>{t.exports=i("dll-reference CKEditor5.dll")("./src/utils.js")},"dll-reference CKEditor5.dll":t=>{"use strict";t.exports=CKEditor5.dll}},e={};function i(r){var n=e[r];if(void 0!==n)return n.exports;var s=e[r]={exports:{}};return t[r](s,s.exports,i),s.exports}i.d=(t,e)=>{for(var r in e)i.o(e,r)&&!i.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var r={};return(()=>{"use strict";i.d(r,{default:()=>B});var t=i("ckeditor5/src/core.js");function e(t,e,i){if(e.attributes)for(const[r,n]of Object.entries(e.attributes))t.setAttribute(r,n,i);e.styles&&t.setStyle(e.styles,i),e.classes&&t.addClass(e.classes,i)}var n=i("ckeditor5/src/engine.js");class s extends n.Observer{observe(t){this.listenTo(t,"load",((t,e)=>{const i=e.target;this.checkShouldIgnoreEventFromTarget(i)||"IMG"==i.tagName&&this._fireEvents(e)}),{useCapture:!0})}stopObserving(t){this.stopListening(t)}_fireEvents(t){this.isEnabled&&(this.document.fire("layoutChanged"),this.document.fire("imageLoaded",t))}}function a(t){return t.createEmptyElement("img")}function o(t){const e=parseFloat(t);return!Number.isNaN(e)&&t===String(e)}function l(t){return"string"==typeof t&&t.endsWith("%")?t:`${parseInt(t,10)}`}const u=[{modelValue:"alignCenter",dataValue:"center"},{modelValue:"alignRight",dataValue:"right"},{modelValue:"alignLeft",dataValue:"left"}];class d extends t.Plugin{static get requires(){return["ImageUtils"]}static get pluginName(){return"DrupalImageEditing"}init(){const{editor:t}=this,{conversion:i}=t,{schema:r}=t.model;if(r.isRegistered("imageInline")&&r.extend("imageInline",{allowAttributes:["dataEntityUuid","dataEntityType","isDecorative"]}),r.isRegistered("imageBlock")&&r.extend("imageBlock",{allowAttributes:["dataEntityUuid","dataEntityType","isDecorative","drupalLinkEntityType","drupalLinkEntityUuid","drupalLinkEntityMetadata"]}),i.for("upcast").add(function(t){function e(e,i,r){const{viewItem:n}=i,{writer:s,consumable:a,safeInsert:o,updateConversionResult:l,schema:d}=r,c=[];let m;if(!a.test(n,{name:!0,attributes:"src"}))return;const g=a.test(n,{name:!0,attributes:"data-caption"});if(m=d.checkChild(i.modelCursor,"imageInline")&&!g?s.createElement("imageInline",{src:n.getAttribute("src")}):s.createElement("imageBlock",{src:n.getAttribute("src")}),t.plugins.has("ImageStyleEditing")&&a.test(n,{name:!0,attributes:"data-align"})){const t=n.getAttribute("data-align"),e=u.find((e=>e.dataValue===t));e&&(s.setAttribute("imageStyle",e.modelValue,m),c.push("data-align"))}if(g){const e=s.createElement("caption"),i=t.data.processor.toView(n.getAttribute("data-caption"));r.consumable.constructor.createFrom(i,r.consumable),r.convertChildren(i,e),s.append(e,m),c.push("data-caption")}const h={dataEntityUuid:"data-entity-uuid",dataEntityType:"data-entity-type",drupalLinkEntityUuid:"data-link-entity-uuid",drupalLinkEntityType:"data-link-entity-type",drupalLinkEntityMetadata:"data-link-entity-metadata"};for(const[t,e]of Object.entries(h))a.test(n,{name:!0,attributes:e})&&(s.setAttribute(t,n.getAttribute(e),m),c.push(e));o(m,i.modelCursor)&&(a.consume(n,{name:!0,attributes:c}),l(m,i))}return t=>{t.on("element:img",e,{priority:"high"})}}(t)).attributeToAttribute({view:{name:"img",key:"width"},model:{key:"resizedWidth",value:t=>o(t.getAttribute("width"))?`${parseInt(t.getAttribute("width"),10)}px`:t.getAttribute("width").trim()}}).attributeToAttribute({view:{name:"img",key:"height"},model:{key:"resizedHeight",value:t=>o(t.getAttribute("height"))?`${parseInt(t.getAttribute("height"),10)}px`:t.getAttribute("height").trim()}}),t.plugins.has("DataFilter")){const e=t.plugins.get("DataFilter");i.for("upcast").add(function(t){function e(e,i,r){if(!i.modelRange)return;const n=i.viewItem.parent;if(!n.is("element","a"))return;if(!i.modelRange.getContainedElement().is("element","imageBlock"))return;const s=t.processViewAttributes(n,r);s&&r.writer.setAttribute("htmlLinkAttributes",s,i.modelRange)}return t=>{t.on("element:img",e,{priority:"high"})}}(e))}i.for("downcast").add(function(){function t(t,e,i){const{item:r}=e,{consumable:n,writer:s}=i;if(!n.consume(r,t.name))return;const a=i.mapper.toViewElement(r),o=Array.from(a.getChildren()).find((t=>"img"===t.name));s.setAttribute("data-entity-uuid",e.attributeNewValue,o||a)}return e=>{e.on("attribute:dataEntityUuid",t)}}()).add(function(){function t(t,e,i){const{item:r}=e,{consumable:n,writer:s}=i;if(!n.consume(r,t.name))return;const a=i.mapper.toViewElement(r),o=Array.from(a.getChildren()).find((t=>"img"===t.name));s.setAttribute("data-entity-type",e.attributeNewValue,o||a)}return e=>{e.on("attribute:dataEntityType",t)}}()).add(function(){function t(t,i,r){const{item:n}=i,{consumable:s,writer:a}=r,o=r.mapper.toViewElement(n);let l=Array.from(o.getChildren()).find((t=>"img"===t.name));l||"image"!==o.name||(l=o);const u={},d={drupalLinkEntityType:"data-entity-type",drupalLinkEntityUuid:"data-entity-uuid",drupalLinkEntityMetadata:"data-entity-metadata"};if(!l)return;Object.keys(d).forEach((t=>{if(i.item.hasAttribute(t)){const e=d[t],r=i.item.getAttribute(t);u[e]=r,l._setAttribute(e.replace("data-","data-link-"),r)}}));const c=a.createContainerElement("a",{href:i.attributeNewValue,...u});a.insert(a.createPositionBefore(l),c),a.move(a.createRangeOn(l),a.createPositionAt(c,0)),r.consumable.consume(i.item,"attribute:htmlLinkAttributes:imageBlock")&&e(r.writer,i.item.getAttribute("htmlLinkAttributes"),c)}return e=>{e.on("attribute:linkHref:imageBlock",t,{priority:"high"})}}()),i.for("dataDowncast").add(function(t){return e=>{e.on("insert:caption",((e,i,r)=>{const{consumable:n,writer:s,mapper:a}=r;if(!t.plugins.get("ImageUtils").isImage(i.item.parent)||!n.consume(i.item,"insert"))return;const o=t.model.createRangeIn(i.item),l=s.createDocumentFragment();a.bindElements(i.item,l);for(const{item:e}of Array.from(o)){const i={item:e,range:t.model.createRangeOn(e)},n=`insert:${e.name||"$text"}`;t.data.downcastDispatcher.fire(n,i,r);for(const n of e.getAttributeKeys())Object.assign(i,{attributeKey:n,attributeOldValue:null,attributeNewValue:i.item.getAttribute(n)}),t.data.downcastDispatcher.fire(`attribute:${n}`,i,r)}for(const t of s.createRangeIn(l).getItems())a.unbindViewElement(t);a.unbindViewElement(l);const u=t.data.processor.toData(l);if(u){const t=a.toViewElement(i.item.parent);s.setAttribute("data-caption",u,t)}}),{priority:"high"})}}(t)).elementToElement({model:"imageBlock",view:(t,{writer:e})=>a(e),converterPriority:"high"}).elementToElement({model:"imageInline",view:(t,{writer:e})=>a(e),converterPriority:"high"}).add(function(){function t(t,e,i){const{item:r}=e,{consumable:n,writer:s}=i,a=u.find((t=>t.modelValue===e.attributeNewValue));if(!a||!n.consume(r,t.name))return;const o=i.mapper.toViewElement(r),l=Array.from(o.getChildren()).find((t=>"img"===t.name));s.setAttribute("data-align",a.dataValue,l||o)}return e=>{e.on("attribute:imageStyle",t,{priority:"high"})}}()).add(function(){function t(t,i,r){if(!r.consumable.consume(i.item,t.name))return;const n=r.mapper.toViewElement(i.item),s=r.writer,a={},o={drupalLinkEntityType:"data-entity-type",drupalLinkEntityUuid:"data-entity-uuid",drupalLinkEntityMetadata:"data-entity-metadata"};Object.keys(o).forEach((t=>{if(i.item.hasAttribute(t)){const e=o[t],r=i.item.getAttribute(t);a[e]=r,n._setAttribute(e.replace("data-","data-link-"),r)}}));const l=s.createContainerElement("a",{href:i.attributeNewValue,...a});s.insert(s.createPositionBefore(n),l),s.move(s.createRangeOn(n),s.createPositionAt(l,0)),r.consumable.consume(i.item,"attribute:htmlLinkAttributes:imageBlock")&&e(r.writer,i.item.getAttribute("htmlLinkAttributes"),l)}return e=>{e.on("attribute:linkHref:imageBlock",t,{priority:"high"})}}()).attributeToAttribute({model:{name:"imageBlock",key:"resizedWidth"},view:t=>({key:"width",value:l(t)}),converterPriority:"high"}).attributeToAttribute({model:{name:"imageInline",key:"resizedWidth"},view:t=>({key:"width",value:l(t)}),converterPriority:"high"}).attributeToAttribute({model:{name:"imageBlock",key:"resizedHeight"},view:t=>({key:"height",value:l(t)}),converterPriority:"high"}).attributeToAttribute({model:{name:"imageInline",key:"resizedHeight"},view:t=>({key:"height",value:l(t)}),converterPriority:"high"}).attributeToAttribute({model:{name:"imageBlock",key:"width"},view:(t,{consumable:e},i)=>i.item.hasAttribute("resizedWidth")?(e.consume(i.item,"attribute:width"),null):{key:"width",value:t},converterPriority:"high"}).attributeToAttribute({model:{name:"imageInline",key:"width"},view:(t,{consumable:e},i)=>i.item.hasAttribute("resizedWidth")?(e.consume(i.item,"attribute:width"),null):{key:"width",value:t},converterPriority:"high"}).attributeToAttribute({model:{name:"imageBlock",key:"height"},view:(t,e,i)=>{if(i.item.hasAttribute("resizedWidth")){if(i.item.getAttribute("resizedWidth").endsWith("%"))return{key:"height",value:i.item.getAttribute("resizedWidth")};const e=parseInt(i.item.getAttribute("resizedWidth"),10),r=parseInt(i.item.getAttribute("width"),10)/parseInt(t,10);return{key:"height",value:`${Math.round(e/r)}`}}return{key:"height",value:t}},converterPriority:"high"}).attributeToAttribute({model:{name:"imageInline",key:"height"},view:(t,e,i)=>{if(i.item.hasAttribute("resizedWidth")){if(i.item.getAttribute("resizedWidth").endsWith("%"))return{key:"height",value:i.item.getAttribute("resizedWidth")};const e=parseInt(i.item.getAttribute("resizedWidth"),10),r=parseInt(i.item.getAttribute("width"),10)/parseInt(t,10);return{key:"height",value:`${Math.round(e/r)}`}}return{key:"height",value:t}},converterPriority:"high"}),t.editing.view.addObserver(s);const n=t.plugins.get("ImageUtils");t.editing.view.document.on("imageLoaded",((e,i)=>{const r=t.editing.view.domConverter.mapDomToView(i.target);if(!r)return;const s=n.getImageWidgetFromImageView(r);if(!s)return;const a=t.editing.mapper.toModelElement(s);a&&t.model.enqueueChange({isUndoable:!1},(()=>{n.setImageNaturalSizeAttributes(a)}))}))}}class c extends t.Command{refresh(){const t=this.editor.plugins.get("ImageUtils").getClosestSelectedImageElement(this.editor.model.document.selection);this.isEnabled=!!t,this.isEnabled&&t.hasAttribute("alt")?this.value=t.getAttribute("alt"):this.value=!1}execute(t){const e=this.editor,i=e.plugins.get("ImageUtils"),r=e.model,n=i.getClosestSelectedImageElement(r.document.selection);r.change((e=>{e.setAttribute("alt",t.newValue,n)}))}}class m extends t.Plugin{static get requires(){return["ImageUtils"]}static get pluginName(){return"DrupalImageAlternativeTextEditing"}constructor(t){super(t),this._missingAltTextViewReferences=new Set}init(){const t=this.editor;t.conversion.for("editingDowncast").add(this._imageEditingDowncastConverter("attribute:alt",t)).add(this._imageEditingDowncastConverter("attribute:src",t)),t.commands.add("imageTextAlternative",new c(this.editor)),t.editing.view.on("render",(()=>{for(const t of this._missingAltTextViewReferences)t.button.element.isConnected||(t.destroy(),this._missingAltTextViewReferences.delete(t))}))}_imageEditingDowncastConverter(t){const e=(t,e,i)=>{const r=this.editor;if(!r.plugins.get("ImageUtils").isImage(e.item))return;const n=i.mapper.toViewElement(e.item),s=Array.from(n.getChildren()).find((t=>t.getCustomProperty("drupalImageMissingAltWarning")));if(e.item.hasAttribute("alt"))return void(s&&i.writer.remove(s));if(s)return;const a=r.ui.componentFactory.create("drupalImageAlternativeTextMissing");a.listenTo(r.ui,"update",(()=>{const t=r.model.document.selection.getFirstRange(),i=r.model.createRangeOn(e.item);a.set({isSelected:t.containsRange(i)||t.isIntersecting(i)})})),a.render(),this._missingAltTextViewReferences.add(a);const o=i.writer.createUIElement("span",{class:"image-alternative-text-missing-wrapper"},(function(t){const e=this.toDomElement(t);return e.appendChild(a.element),e}));i.writer.setCustomProperty("drupalImageMissingAltWarning",!0,o),i.writer.insert(i.writer.createPositionAt(n,"end"),o)};return i=>{i.on(t,e,{priority:"low"})}}}var g=i("ckeditor5/src/ui.js");function h(t){const e=t.plugins.get("ContextualBalloon");if(t.plugins.get("ImageUtils").getClosestSelectedImageWidget(t.editing.view.document.selection)){const i=p(t);e.updatePosition(i)}}function p(t){const e=t.editing.view,i=g.BalloonPanelView.defaultPositions,r=t.plugins.get("ImageUtils");return{target:e.domConverter.mapViewToDom(r.getClosestSelectedImageWidget(e.document.selection)),positions:[i.northArrowSouth,i.northArrowSouthWest,i.northArrowSouthEast,i.southArrowNorth,i.southArrowNorthWest,i.southArrowNorthEast,i.viewportStickyNorth]}}var b=i("ckeditor5/src/utils.js");class f extends g.View{constructor(t){super(t),this.focusTracker=new b.FocusTracker,this.keystrokes=new b.KeystrokeHandler,this.decorativeToggle=this._decorativeToggleView(),this.labeledInput=this._createLabeledInputView(),this.saveButtonView=this._createButton(Drupal.t("Save"),'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M6.972 16.615a1 1 0 0 1-.744-.292l-4.596-4.596a1 1 0 1 1 1.414-1.414l3.926 3.926 9.937-9.937a1 1 0 0 1 1.414 1.415L7.717 16.323a1 1 0 0 1-.745.292"/></svg>',"ck-button-save"),this.saveButtonView.type="submit",this.saveButtonView.bind("isEnabled").to(this.decorativeToggle,"isOn",this.labeledInput,"isEmpty",((t,e)=>t||!e)),this.cancelButtonView=this._createButton(Drupal.t("Cancel"),'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="m11.591 10.177 4.243 4.242a1 1 0 0 1-1.415 1.415l-4.242-4.243-4.243 4.243a1 1 0 0 1-1.414-1.415l4.243-4.242L4.52 5.934A1 1 0 0 1 5.934 4.52l4.243 4.243 4.242-4.243a1 1 0 1 1 1.415 1.414z"/></svg>',"ck-button-cancel","cancel"),this._focusables=new g.ViewCollection,this._focusCycler=new g.FocusCycler({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.setTemplate({tag:"form",attributes:{class:["ck","ck-text-alternative-form","ck-text-alternative-form--with-decorative-toggle","ck-responsive-form"],tabindex:"-1"},children:[{tag:"div",attributes:{class:["ck","ck-text-alternative-form__decorative-toggle"]},children:[this.decorativeToggle]},this.labeledInput,this.saveButtonView,this.cancelButtonView]})}render(){super.render(),this.keystrokes.listenTo(this.element),(0,g.submitHandler)({view:this}),[this.decorativeToggle,this.labeledInput,this.saveButtonView,this.cancelButtonView].forEach((t=>{this._focusables.add(t),this.focusTracker.add(t.element)}))}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}_createButton(t,e,i,r){const n=new g.ButtonView(this.locale);return n.set({label:t,icon:e,tooltip:!0}),n.extendTemplate({attributes:{class:i}}),r&&n.delegate("execute").to(this,r),n}_createLabeledInputView(){const t=new g.LabeledFieldView(this.locale,g.createLabeledInputText);return t.bind("class").to(this.decorativeToggle,"isOn",(t=>t?"ck-hidden":"")),t.label=Drupal.t("Alternative text"),t}_decorativeToggleView(){const t=new g.SwitchButtonView(this.locale);return t.set({withText:!0,label:Drupal.t("Decorative image")}),t.on("execute",(()=>{t.set("isOn",!t.isOn)})),t}}class w extends g.View{constructor(t){super(t);const e=this.bindTemplate;this.set("isVisible"),this.set("isSelected");const i=Drupal.t("Add missing alternative text");this.button=new g.ButtonView(t),this.button.set({label:i,tooltip:!1,withText:!0}),this.setTemplate({tag:"span",attributes:{class:["image-alternative-text-missing",e.to("isVisible",(t=>t?"":"ck-hidden"))],title:i},children:[this.button]})}}class v extends t.Plugin{static get requires(){return[g.ContextualBalloon]}static get pluginName(){return"DrupalImageTextAlternativeUI"}init(){this._createButton(),this._createForm(),this._createMissingAltTextComponent();const t=()=>{this.editor.plugins.get("ImageUtils").getClosestSelectedImageWidget(this.editor.editing.view.document.selection)&&this._showForm()};if(this.editor.commands.get("insertImage")){this.editor.commands.get("insertImage").on("execute",t)}if(this.editor.plugins.has("ImageUploadEditing")){this.editor.plugins.get("ImageUploadEditing").on("uploadComplete",t)}}_createMissingAltTextComponent(){this.editor.ui.componentFactory.add("drupalImageAlternativeTextMissing",(t=>{const e=new w(t);return e.listenTo(e.button,"execute",(()=>{this._isInBalloon&&this._balloon.remove(this._form),this._showForm()})),e.listenTo(this.editor.ui,"update",(()=>{e.set({isVisible:!this._isVisible||!e.isSelected})})),e}))}destroy(){super.destroy(),this._form.destroy()}_createButton(){const t=this.editor;t.ui.componentFactory.add("drupalImageAlternativeText",(e=>{const i=t.commands.get("imageTextAlternative"),r=new g.ButtonView(e);return r.set({label:Drupal.t("Change image alternative text"),icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M5.085 6.22 2.943 4.078a.75.75 0 1 1 1.06-1.06l2.592 2.59A11.1 11.1 0 0 1 10 5.068c4.738 0 8.578 3.101 8.578 5.083 0 1.197-1.401 2.803-3.555 3.887l1.714 1.713a.75.75 0 0 1-.09 1.138.5.5 0 0 1-.15.084.75.75 0 0 1-.821-.16L6.17 7.304q-.387.166-.757.365l6.239 6.24-.006.005.78.78q-.582.141-1.174.215l-1.11-1.11h.011L4.55 8.197a7 7 0 0 0-.665.514l-.112.098 4.897 4.897-.005.006 1.276 1.276a10 10 0 0 1-1.477-.117l-.479-.479-.009.009-4.863-4.863-.022.031a3 3 0 0 0-.124.2q-.065.116-.108.241a.5.5 0 0 0-.028.133.3.3 0 0 0 .008.072 1 1 0 0 0 .082.226q.1.2.234.379l3.242 3.365.025.01.59.623c-3.265-.918-5.59-3.155-5.59-4.668 0-1.194 1.448-2.838 3.663-3.93m7.07.531a4.63 4.63 0 0 1 1.108 5.992l.345.344.046-.018a9.3 9.3 0 0 0 2-1.112q.385-.281.727-.613.207-.2.392-.431.109-.135.203-.286.086-.14.148-.292a1 1 0 0 0 .036-.12.3.3 0 0 0 .008-.072.5.5 0 0 0-.028-.133 1 1 0 0 0-.036-.096 2 2 0 0 0-.071-.145 3 3 0 0 0-.125-.2 4 4 0 0 0-.263-.335 5.4 5.4 0 0 0-.53-.523 8 8 0 0 0-1.054-.768 9.8 9.8 0 0 0-1.879-.891q-.506-.178-1.027-.301m-2.85.21-.069.002a.5.5 0 0 0-.254.097.496.496 0 0 0-.104.679.5.5 0 0 0 .326.199l.045.005c.091.003.181.003.272.012a2.45 2.45 0 0 1 2.017 1.513c.024.061.043.125.069.185a.49.49 0 0 0 .45.287h.008a.5.5 0 0 0 .35-.158.48.48 0 0 0 .13-.335.6.6 0 0 0-.048-.219 3.4 3.4 0 0 0-.36-.723 3.44 3.44 0 0 0-2.791-1.543l-.028-.001z"/></svg>',tooltip:!0}),r.bind("isEnabled").to(i,"isEnabled"),this.listenTo(r,"execute",(()=>{this._showForm()})),r}))}_createForm(){const t=this.editor,e=t.editing.view.document,i=t.plugins.get("ImageUtils");this._balloon=this.editor.plugins.get("ContextualBalloon"),this._form=new((0,g.CssTransitionDisablerMixin)(f))(t.locale),this._form.render(),this.listenTo(this._form,"submit",(()=>{t.execute("imageTextAlternative",{newValue:this._form.decorativeToggle.isOn?"":this._form.labeledInput.fieldView.element.value}),this._hideForm(!0)})),this.listenTo(this._form,"cancel",(()=>{this._hideForm(!0)})),this.listenTo(this._form.decorativeToggle,"execute",(()=>{h(t)})),this._form.keystrokes.set("Esc",((t,e)=>{this._hideForm(!0),e()})),this.listenTo(t.ui,"update",(()=>{i.getClosestSelectedImageWidget(e.selection)?this._isVisible&&h(t):this._hideForm(!0)})),(0,g.clickOutsideHandler)({emitter:this._form,activator:()=>this._isVisible,contextElements:[this._balloon.view.element],callback:()=>this._hideForm()})}_showForm(){if(this._isVisible)return;const t=this.editor,e=t.commands.get("imageTextAlternative"),i=this._form.decorativeToggle,r=this._form.labeledInput;this._form.disableCssTransitions(),this._isInBalloon||this._balloon.add({view:this._form,position:p(t)}),i.isOn=""===e.value,r.fieldView.element.value=e.value||"",r.fieldView.value=r.fieldView.element.value,i.isOn?i.focus():r.fieldView.select(),this._form.enableCssTransitions()}_hideForm(t){this._isInBalloon&&(this._form.focusTracker.isFocused&&this._form.saveButtonView.focus(),this._balloon.remove(this._form),t&&this.editor.editing.view.focus())}get _isVisible(){return this._balloon.visibleView===this._form}get _isInBalloon(){return this._balloon.hasView(this._form)}}class y extends t.Plugin{static get requires(){return[m,v]}static get pluginName(){return"DrupalImageAlternativeText"}}class k extends t.Plugin{static get requires(){return[d,y]}static get pluginName(){return"DrupalImage"}}const A=k;class I extends t.Plugin{init(){const{editor:t}=this;t.plugins.get("ImageUploadEditing").on("uploadComplete",((e,{data:i,imageElement:r})=>{t.model.change((t=>{t.setAttribute("dataEntityUuid",i.response.uuid,r),t.setAttribute("dataEntityType",i.response.entity_type,r)}))}))}static get pluginName(){return"DrupalImageUploadEditing"}}var E=i("ckeditor5/src/upload.js");class x{constructor(t,e){this.loader=t,this.options=e}upload(){return this.loader.file.then((t=>new Promise(((e,i)=>{this._initRequest(),this._initListeners(e,i,t),this._sendRequest(t)}))))}abort(){this.xhr&&this.xhr.abort()}_initRequest(){this.xhr=new XMLHttpRequest,this.xhr.open("POST",this.options.uploadUrl,!0),this.xhr.responseType="json"}_initListeners(t,e,i){const r=this.xhr,n=this.loader,s=`Couldn't upload file: ${i.name}.`;r.addEventListener("error",(()=>e(s))),r.addEventListener("abort",(()=>e())),r.addEventListener("load",(()=>{const i=r.response;if(!i||i.error)return e(i?.error?.message||s);t({response:i,urls:{default:i.url}})})),r.upload&&r.upload.addEventListener("progress",(t=>{t.lengthComputable&&(n.uploadTotal=t.total,n.uploaded=t.loaded)}))}_sendRequest(t){const e=this.options.headers||{},i=this.options.withCredentials||!1;Object.keys(e).forEach((t=>{this.xhr.setRequestHeader(t,e[t])})),this.xhr.withCredentials=i;const r=new FormData;r.append("upload",t),this.xhr.send(r)}}class _ extends t.Plugin{static get requires(){return[E.FileRepository]}static get pluginName(){return"DrupalFileRepository"}init(){const t=this.editor.config.get("drupalImageUpload");t&&(t.uploadUrl?this.editor.plugins.get(E.FileRepository).createUploadAdapter=e=>new x(e,t):(0,b.logWarning)("simple-upload-adapter-missing-uploadurl"))}}class T extends t.Plugin{static get requires(){return[_,I]}static get pluginName(){return"DrupalImageUpload"}}const V=T;class C extends t.Plugin{init(){const{editor:t}=this;t.ui.componentFactory.add("drupalInsertImage",(()=>t.ui.componentFactory.create("insertImage")))}static get pluginName(){return"DrupalInsertImage"}}const B={DrupalImage:A,DrupalImageUpload:V,DrupalInsertImage:C}})(),r=r.default})()));